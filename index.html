<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Cyber 20/20 Chatbot</title>
		<script type="text/javascript" src="jquery-3.1.1.js" ></script>

	</head>
	<body>
	<script>

	function reply() {
		document.getElementById("botresponse").innerHTML = document.getElementById("textbox").value;
	};



	document.addEventListener("dragover", function (event)
	{
		event.preventDefault();

		document.getElementById("botresponse").innerHTML = "File hovering";

		return false;}, false
	);




	document.addEventListener("drop", function (event)
	{
		event.preventDefault();

		document.getElementById("botresponse").innerHTML = "File Dropped";

	  var sha256 = require('js-sha256');
		var files = event.target.files || event.dataTransfer.files;
		var table = document.getElementById("reportTable");

		for (var i = 0, file; file = files[i]; i++) {

	    // Append a new row to the HTML document
	    var row = table.insertRow(-1);
	    var cell1 = row.insertCell(0);
	    var cell2 = row.insertCell(1);
	    var cell3 = row.insertCell(2);
			var cell4 = row.insertCell(3);

	    cell1.innerHTML = files[i].name;
	    cell2.innerHTML = files[i].size;
	    cell3.innerHTML = files[i].type;
			cell4.innerHTML = sha256(files[i].name);
		}
	  return false;
	}, false);

  function trythis(){


		 var myUrl = "http://fcas-test.us-east-1.elasticbeanstalk.com";
     var myKey = "/devel";


		 var myCommand = "/target/describe/Goodware";
//		 var myCommand = "/threat/describe/0014ee0d96e989913c21e0e4414bb8c0b44997198bab5ae6a739da4987a4bfb5";
//		 var myCommand = "/threat/list/0/10";

		 var myFullUrl = myUrl + myKey + myCommand;


 	   document.getElementById("botresponse").innerHTML = "URL: " + myUrl + "<br>" +	"KEY: " + myKey + "<br>" + "COMMAND: " + myCommand;

			 function httpGetAsync(myFullUrl, callback)
			 {
			     var xmlHttp = new XMLHttpRequest();
			     xmlHttp.onreadystatechange = function() {
			         if (xmlHttp.readyState == 4){
			             callback(
										 xmlHttp.responseText,
										 xmlHttp.status);
			         }
			     }
			     xmlHttp.open("GET", myFullUrl, true); // true for asynchronous
			     xmlHttp.send(null);
			 }

       httpGetAsync(myFullUrl, displayText);


	}; // tryThis


	function displayText(responseText, status){

		document.getElementById("GETstatus").innerHTML = "responseText: " + responseText;

			var txt = JSON.parse(responseText);

			document.getElementById("parsedJSON").innerHTML =
			"Target: " + txt.target +
			"<br>Description: " + txt.description +
			"<br>Severity: " + txt.severity;


	};


  </script>




		<h1>Cyber 20/20 Chatbot</h1>
		<p>Use the text-box below to interface with the chat-bot</p>
		<input id="textbox" type="text" placeholder="What family of malware is this?" />
		<input type="submit" onclick="reply()"/>
		<h2>Response</h2>

		<table id = "reportTable" align="center" border = "1" width=80%>
      <th>Name</th>
      <th>Size</th>
      <th>Type</th>
			<th>Hash</th>

      <tr id = "tableRow">
        <td id = "fileName"></td>
        <td id = "fileSize"></td>
        <td id = "fileType"></td>
				<td id = "fileHash"></td>
	    </tr>

    </table>
		<input id="button" type="submit" onclick="trythis()">
		<p id="botresponse"></p>
		<p id="GETstatus"></p>
		<p id="parsedJSON"></p>

		<div></div>
	</body>
</html>
