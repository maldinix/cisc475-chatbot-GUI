<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Cyber 20/20 Chatbot</title>
	<script type="text/javascript" src="jquery-3.1.1.js" ></script>
	<link rel="stylesheet" type="text/css" href="cyber2020.css" media="screen" />

	<!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Numeric JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>

</head>
<body>
	<script>

		function submitHash() {

			getDataFromBackEnd(document.getElementById("textboxGetHash").value);

			return;
		};



		document.addEventListener("dragover", function (event) {
			event.preventDefault();
			return false;}, false
		);


		document.addEventListener("drop", function (event){
			event.preventDefault();

			buildTable(); // build table containing data on files dragged onto canvas

			return false;
		}, false);


		function buildTable(){

			var sha256 = require('js-sha256');
			var files = event.target.files || event.dataTransfer.files;
			var table = document.getElementById("reportTable");

			for (var i = 0, file; file = files[i]; i++) {

				// Append a new row to the HTML document
				var row = table.insertRow(-1);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);

				cell1.innerHTML = files[i].name;
				cell2.innerHTML = files[i].size;
				cell3.innerHTML = files[i].type;
				cell4.innerHTML = sha256(files[i].name);


			};


			var data = [{
				values: [files[0].size, files[1].size, files[2].size],
				labels: [files[0].name, files[1].name, files[2].name],

				type: 'pie'
			}];

			var layout = {
				height: 380,
				width: 480
			};

			Plotly.newPlot('myChartDiv', data, layout);


			return;

		};

	function getDataFromBackEnd(myHash){


		var myUrl = "http://fcas-test.us-east-1.elasticbeanstalk.com";
		var myKey = "/devel";


		//     var myCommand = "/target/describe/Goodware";
		//		 var myCommand = "/threat/describe/0014ee0d96e989913c21e0e4414bb8c0b44997198bab5ae6a739da4987a4bfb5";
		//		 var myCommand = "/threat/list/0/10";

	  var myCommand = "/threat/describe/";


		var myFullUrl = myUrl + myKey + myCommand + myHash;

		function httpGetAsync(myFullUrl, callback) {

			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
				if (xmlHttp.readyState == 4){
					callback(
						xmlHttp.responseText,
						xmlHttp.status);
					}
				}
				xmlHttp.open("GET", myFullUrl, true); // true for asynchronous
				xmlHttp.send(null);
			}

			httpGetAsync(myFullUrl, displayJSONText);


		}; // tryThis

		function refresh(){

			// empty table
			var tableHeaderRowCount = 1;
			var table = document.getElementById('reportTable');
			var rowCount = table.rows.length;
			for (var i = tableHeaderRowCount; i < rowCount; i++) {
				table.deleteRow(tableHeaderRowCount);
			}

			// clear hash text box
			document.getElementById("textboxGetHash").value = "";

			// clear responsetext
			document.getElementById("responseJSON").innerHTML = "";
			document.getElementById("parsedJSON").innerHTML = "";

			// remove chart
			var div = document.getElementById('myChartDiv');
			while(div.firstChild){
			    div.removeChild(div.firstChild);
			}
			return;

		};


		function displayJSONText(responseText, status){

			document.getElementById("responseJSON").innerHTML = "responseText: " + responseText;

/*
			var txt = JSON.parse(responseText);

			document.getElementById("parsedJSON").innerHTML =
			"Target: " + txt.target +
			"<br>Description: " + txt.description +
			"<br>Severity: " + txt.severity;
*/

		};

		function quitApp(){
			window.opener = self;
			window.close();
		}




		</script>




		<h1 id="title">Cyber 20/20 Chatbot</h1>
		<input id="textboxGetHash" type="text" placeholder="Enter hash here" style="width: 460px;"/>
		<input type="submit" value="Submit Hash" onclick="submitHash()"/>

		<input id="quitAppButton" type="submit" value="Quit" onclick="quitApp()">
		<input id="refreshButton" type="submit" value="Refresh" onclick="refresh()">

		<table id = "reportTable" align="center" border = "1" width=100%>
			<th>Name</th>
			<th>Size</th>
			<th>Type</th>
			<th>Hash</th>

			<tr id = "tableRow">
				<td id = "fileName"></td>
				<td id = "fileSize"></td>
				<td id = "fileType"></td>
				<td id = "fileHash"></td>
			</tr>

		</table>


		<p id="responseJSON"></p>
		<p id="parsedJSON"></p>


<!--		<div id="myChartDiv"  style="width: 480px; height: 380px;"></div>-->
		<div id="myChartDiv"><!-- Plotly chart will be drawn inside this DIV --></div>



	</body>
	</html>
